import sys
import json
import datetime 
import pandas as pd

# Keep history
current_time = datetime.datetime.now() 
url = sys.argv[1]
# url = "12"
data = url + " --- " + str(current_time) + '\n'
f = open("D:/College/BE/ZecurePlus/ML/chrome_extension/logs/URL_visited.txt", "a") #anish
# f = open("E:/Anshul/BE_project/ZecurePlus/ML/chrome_extension/logs/URL_visited.txt", "a") #Anshul
f.write(data)
f.close()

# update Stats
f = open('D:/College/BE/ZecurePlus/ML/chrome_extension/logs/track.json', 'r') #Anish's Path
# f = open('E:/Anshul/BE_project/ZecurePlus/ML/chrome_extension/logs/track.json', 'r') #Anshul's path
data = json.load(f)
f.close()
data["sites_tracked"] = data["sites_tracked"] + 1
f = open('D:/College/BE/ZecurePlus/ML/chrome_extension/logs/track.json', 'w') #Anish's Path
# f = open('E:/Anshul/BE_project/ZecurePlus/ML/chrome_extension/logs/track.json', 'w') #Anshul's path
json.dump(data, f)
f.close()

# Keep count
df = pd.read_csv("D:/College/BE/ZecurePlus/ML/chrome_extension/logs/count.csv") #Anish's Path
# df = pd.read_csv("E:/Anshul/BE_project/ZecurePlus/ML/chrome_extension/logs/count.csv") #Anshuls's Path

if df.empty:
    temp = {'URL':url, 'Count':1}
    df = df.append(temp, ignore_index=True)
else:    
    search = df.loc[df['URL'] == url]
    if search.empty:
        temp = {'URL':url, 'Count':1}
        df = df.append(temp, ignore_index=True)
    else:
        df.loc[df['URL'] == url, 'Count'] = df.loc[df['URL'] == url, 'Count'].values[0]+1

df = df.sort_values(by=['Count'], ascending=False)
# df.to_csv("E:/Anshul/BE_project/ZecurePlus/ML/chrome_extension/logs/count.csv", index=False) #Anshul
df.to_csv("D:/College/BE/ZecurePlus/ML/chrome_extension/logs/count.csv", index=False) #Anish 