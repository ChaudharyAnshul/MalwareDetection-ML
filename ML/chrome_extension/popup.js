// Purpose - This file contains all the logic relevant to the extension such as getting the URL, calling the server
// side clientServer.php which then calls the core logic.
transfer();
stats();
function transfer(){	
	var tablink;
	chrome.tabs.getSelected(null,function(tab) {
	   	tablink = tab.url;
		// $("#p1").text("The URL being tested is - "+tablink);
		params="url="+tablink;
        $.ajax({
            type:'post',
            url:'http://localhost/ChromeExtension/getUrl.php',
            // url:'http://localhost:8012/ChromeExtension/getUrl.php',
            data:{url:params},
            success: function(data){ 
                // alert(data+"132");
                if(data.trim() == 'good'){
                    $('.foot').css('background-color','#4CAF50');
                    $('#div1').text('Safe');
                }
                else if(data.trim() == 'bad'){
                    $('.foot').css('background-color','rgb(178, 8, 55)');
                    $('#div1').css('color','white');
                    $('#div1').text('Not Safe');
                }
            }
        });
        
        var markup = "url="+tablink+"&html="+document.documentElement.innerHTML;
        // console.log("data");

        
		
        // $("#div").text(markup)
	});
}

function stats(){	
    $.ajax({
        type:'post',
        url:'http://localhost/ChromeExtension/stats.php',
        // url:'http://localhost:8012/ChromeExtension/stats.php',
        data:{},
        success: function(data){ 
            data = data.replace("\n", "");
            var res = data.split(" ");
            $('#track').text(res[0])
            $('#block').text(res[1])
        }
    });
}




$(document).ready(function(){
    $(".button").click(function(){	
        var val = transfer();
        $('#div1').text('Processing...');
        // $('.foot').css('background-color','#4CAF50');
        // $('#div1').css('color','green');
        // $('#div1').text('Safe');
    });
});

chrome.tabs.getSelected(null,function(tab) {
    var tablink = tab.url;
    if(tablink.length>36){
        tablink = tablink.substring(0,36)+'....';
    }
    $("#p1").append(tablink);
});
